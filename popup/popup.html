<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FavURL - Bookmark Manager</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="header-title">FavURL</h1>
            <p class="header-subtitle">Bookmark Manager</p>

            <!-- Header Controls -->
            <div class="header-controls">
                <!-- Start Page Toggle -->
                <div class="start-page-toggle">
                    <label class="toggle-label" for="startPageToggle">
                        <span class="toggle-text">Enable Start Page</span>
                        <div class="toggle-switch">
                            <input type="checkbox" id="startPageToggle" class="toggle-input" checked>
                            <span class="toggle-slider"></span>
                        </div>
                    </label>
                </div>

                <!-- Open in New Tab Toggle -->
                <div class="open-new-tab-toggle">
                    <label class="toggle-label" for="openNewTabToggle">
                        <span class="toggle-text">Open in New Tab</span>
                        <div class="toggle-switch">
                            <input type="checkbox" id="openNewTabToggle" class="toggle-input" checked>
                            <span class="toggle-slider"></span>
                        </div>
                    </label>
                </div>

                <!-- Menu Button -->
                <div class="menu-container">
                    <button class="menu-button" id="menuButton" aria-label="Options menu" aria-expanded="false">
                        <span class="menu-icon">⋮</span>
                    </button>
                    <div class="menu-dropdown" id="menuDropdown" role="menu" aria-hidden="true">
                        <button class="menu-item" id="exportData" role="menuitem">
                            <span class="menu-item-icon">⬇</span>
                            <span class="menu-item-text">Export Data</span>
                        </button>
                        <button class="menu-item" id="importData" role="menuitem">
                            <span class="menu-item-icon">⬆</span>
                            <span class="menu-item-text">Import Data</span>
                        </button>
                        <button class="menu-item" id="colorSettings" role="menuitem">
                            <span class="menu-item-icon">🎨</span>
                            <span class="menu-item-text">Color...</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Hidden file input for import -->
            <input type="file" id="importFileInput" accept=".json" style="display: none;" aria-label="Select JSON file to import">
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Search Section (placeholder for future implementation) -->
            <section class="search-section" style="display: none;">
                <input type="text" class="search-input" placeholder="Search bookmarks..." aria-label="Search bookmarks">
                <button class="search-clear" aria-label="Clear search">×</button>
            </section>

            <!-- Action Buttons -->
            <section class="action-section">
                <button class="btn btn-primary add-current-url" aria-label="Save current tab URL">
                    Save Current Tab
                </button>
                <button class="btn btn-secondary add-manual-url" aria-label="Add URL manually">
                    Add URL
                </button>
                <button class="btn btn-tertiary create-group-btn" aria-label="Create new group">
                    Create Group
                </button>
            </section>

            <!-- Groups Filter (placeholder for future implementation) -->
            <section class="filter-section" style="display: none;">
                <select class="group-filter" aria-label="Filter by group">
                    <option value="all">All Groups</option>
                    <option value="ungrouped">Ungrouped</option>
                </select>
            </section>

            <!-- URL List Container -->
            <section class="url-list-section">
                <div class="url-list" id="urlList" role="list" aria-label="Saved bookmarks">
                    <!-- URLs will be dynamically inserted here -->
                    <div class="empty-state" id="emptyState">
                        <p>No bookmarks saved yet</p>
                        <p class="empty-state-subtitle">Click "Save Current Tab" to get started</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer (placeholder for future features) -->
        <footer class="footer" style="display: none;">
            <button class="btn btn-tertiary export-btn" aria-label="Export bookmarks">Export</button>
            <button class="btn btn-tertiary import-btn" aria-label="Import bookmarks">Import</button>
        </footer>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modalOverlay" style="display: none;" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Modal Title</h2>
                <button class="modal-close" aria-label="Close modal">×</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be dynamically inserted here -->
            </div>
            <div class="modal-footer" id="modalFooter">
                <!-- Modal buttons will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Group Creation Modal Template (hidden) -->
    <template id="createGroupModalTemplate">
        <form class="create-group-form" id="createGroupForm">
            <div class="form-group">
                <label class="form-label" for="groupName">Group Name</label>
                <input type="text"
                       class="form-input"
                       id="groupName"
                       name="groupName"
                       placeholder="Enter group name"
                       maxlength="50"
                       required
                       aria-describedby="groupNameHelp">
                <div class="form-help" id="groupNameHelp">Maximum 50 characters</div>
                <div class="form-error" id="groupNameError" role="alert" aria-live="polite"></div>
            </div>

            <div class="form-group">
                <label class="form-label" for="groupColor">Group Color</label>
                <div class="color-picker-container">
                    <input type="color"
                           class="form-color-input"
                           id="groupColor"
                           name="groupColor"
                           value="#2196f3"
                           aria-label="Choose group color">
                    <div class="color-preview" id="colorPreview"></div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="groupDescription">Description (Optional)</label>
                <textarea class="form-input form-textarea"
                          id="groupDescription"
                          name="groupDescription"
                          placeholder="Brief description of this group"
                          maxlength="200"
                          rows="3"></textarea>
                <div class="form-help">Maximum 200 characters</div>
            </div>
        </form>
    </template>

    <!-- Group Creation Modal Footer Template (hidden) -->
    <template id="createGroupModalFooterTemplate">
        <button type="button" class="btn btn-secondary" id="cancelCreateGroup">Cancel</button>
        <button type="submit" class="btn btn-primary" form="createGroupForm" id="saveCreateGroup">Create Group</button>
    </template>

    <!-- Edit Group Modal Template (hidden) -->
    <template id="editGroupModalTemplate">
        <form class="edit-group-form" id="editGroupForm">
            <div class="form-group">
                <label class="form-label" for="editGroupName">Group Name</label>
                <input type="text"
                       class="form-input"
                       id="editGroupName"
                       name="editGroupName"
                       placeholder="Enter group name"
                       maxlength="50"
                       required
                       aria-describedby="editGroupNameHelp">
                <div class="form-help" id="editGroupNameHelp">Maximum 50 characters</div>
                <div class="form-error" id="editGroupNameError" role="alert" aria-live="polite"></div>
            </div>

            <input type="hidden" id="editGroupId" name="editGroupId" value="">
        </form>
    </template>

    <!-- Edit Group Modal Footer Template (hidden) -->
    <template id="editGroupModalFooterTemplate">
        <button type="button" class="btn btn-secondary" id="cancelEditGroup">Cancel</button>
        <button type="submit" class="btn btn-primary" form="editGroupForm" id="saveEditGroup">OK</button>
    </template>

    <!-- Add URL Modal Template (hidden) -->
    <template id="addURLModalTemplate">
        <form class="add-url-form" id="addURLForm">
            <div class="form-group">
                <label class="form-label" for="urlAddress">URL</label>
                <input type="url"
                       class="form-input"
                       id="urlAddress"
                       name="urlAddress"
                       placeholder="https://example.com"
                       required
                       aria-describedby="urlAddressHelp">
                <div class="form-help" id="urlAddressHelp">Enter the complete URL including https://</div>
                <div class="form-error" id="urlAddressError" role="alert" aria-live="polite"></div>
            </div>

            <div class="form-group">
                <label class="form-label" for="urlTitle">Title</label>
                <input type="text"
                       class="form-input"
                       id="urlTitle"
                       name="urlTitle"
                       placeholder="Page title"
                       maxlength="200"
                       required
                       aria-describedby="urlTitleHelp">
                <div class="form-help" id="urlTitleHelp">Maximum 200 characters</div>
                <div class="form-error" id="urlTitleError" role="alert" aria-live="polite"></div>
            </div>

            <div class="form-group">
                <label class="form-label" for="urlGroup">Group</label>
                <select class="form-select"
                        id="urlGroup"
                        name="urlGroup"
                        aria-label="Select group for this URL">
                    <!-- Groups will be populated dynamically -->
                </select>
                <div class="form-help">Choose which group to save this URL to</div>
            </div>
        </form>
    </template>

    <!-- Add URL Modal Footer Template (hidden) -->
    <template id="addURLModalFooterTemplate">
        <button type="button" class="btn btn-secondary" id="cancelAddURL">Cancel</button>
        <button type="submit" class="btn btn-primary" form="addURLForm" id="saveAddURL">Save URL</button>
    </template>

    <!-- Edit URL Modal Template (hidden) -->
    <template id="editURLModalTemplate">
        <form class="edit-url-form" id="editURLForm">
            <div class="form-group">
                <label class="form-label" for="editUrlAddress">URL</label>
                <input type="url"
                       class="form-input"
                       id="editUrlAddress"
                       name="editUrlAddress"
                       placeholder="https://example.com"
                       required
                       aria-describedby="editUrlAddressHelp">
                <div class="form-help" id="editUrlAddressHelp">Enter the complete URL including https://</div>
                <div class="form-error" id="editUrlAddressError" role="alert" aria-live="polite"></div>
            </div>

            <div class="form-group">
                <label class="form-label" for="editUrlTitle">Title</label>
                <input type="text"
                       class="form-input"
                       id="editUrlTitle"
                       name="editUrlTitle"
                       placeholder="Page title"
                       maxlength="200"
                       required
                       aria-describedby="editUrlTitleHelp">
                <div class="form-help" id="editUrlTitleHelp">Maximum 200 characters</div>
                <div class="form-error" id="editUrlTitleError" role="alert" aria-live="polite"></div>
            </div>

            <div class="form-group">
                <label class="form-label" for="editUrlGroup">Group</label>
                <select class="form-select"
                        id="editUrlGroup"
                        name="editUrlGroup"
                        aria-label="Select group for this URL">
                    <!-- Groups will be populated dynamically -->
                </select>
                <div class="form-help">Choose which group this URL belongs to</div>
            </div>

            <input type="hidden" id="editUrlId" name="editUrlId" value="">
        </form>
    </template>

    <!-- Edit URL Modal Footer Template (hidden) -->
    <template id="editURLModalFooterTemplate">
        <button type="button" class="btn btn-secondary" id="cancelEditURL">Cancel</button>
        <button type="button" class="btn btn-tertiary" id="deleteEditURL">Delete</button>
        <button type="submit" class="btn btn-primary" form="editURLForm" id="saveEditURL">Save Changes</button>
    </template>

    <!-- Import Confirmation Modal Template (hidden) -->
    <template id="importConfirmationModalTemplate">
        <form class="import-confirmation-form" id="importConfirmationForm">
            <div class="import-summary">
                <h3>Import Data Summary</h3>
                <div class="import-stats">
                    <div class="stat-item">
                        <span class="stat-label">Groups:</span>
                        <span class="stat-value" id="importGroupCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">URLs:</span>
                        <span class="stat-value" id="importUrlCount">0</span>
                    </div>
                </div>
            </div>

            <div class="import-options">
                <h4>How would you like to import this data?</h4>

                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="importMode" value="replace" id="importModeReplace" checked>
                        <span class="radio-label">
                            <strong>Replace All Data</strong>
                            <small>Completely replace your existing bookmarks with the imported data. Any bookmarks not in the import file will be deleted.</small>
                        </span>
                    </label>

                    <label class="radio-option">
                        <input type="radio" name="importMode" value="merge" id="importModeMerge">
                        <span class="radio-label">
                            <strong>Merge Data</strong>
                            <small>Add imported bookmarks to your existing ones. Duplicates will be updated if they have newer timestamps.</small>
                        </span>
                    </label>
                </div>
            </div>

            <div class="import-warning" id="replaceWarning">
                <div class="warning-icon">⚠️</div>
                <div class="warning-text">
                    <strong>Warning:</strong> Replace mode will permanently delete all existing bookmarks that are not in the import file. This action cannot be undone.
                </div>
            </div>
        </form>
    </template>

    <!-- Import Confirmation Modal Footer Template (hidden) -->
    <template id="importConfirmationModalFooterTemplate">
        <button type="button" class="btn btn-secondary" id="cancelImport">Cancel</button>
        <button type="submit" class="btn btn-primary" form="importConfirmationForm" id="confirmImport">Import Data</button>
    </template>

    <!-- Color Settings Modal Template (hidden) -->
    <template id="colorSettingsModalTemplate">
        <form class="color-settings-form" id="colorSettingsForm">
            <div class="form-group">
                <label class="form-label" for="pageBackgroundColor">Start Page Background Color</label>
                <div class="color-picker-container">
                    <input type="color"
                           class="form-color-input"
                           id="pageBackgroundColor"
                           name="pageBackgroundColor"
                           value="#f5f5f5"
                           aria-label="Choose page background color">
                    <input type="text"
                           class="form-input color-hex-input"
                           id="pageBackgroundColorHex"
                           name="pageBackgroundColorHex"
                           value="#f5f5f5"
                           pattern="^#[0-9A-Fa-f]{6}$"
                           maxlength="7"
                           placeholder="#f5f5f5">
                </div>
                <div class="form-help">Background color for the start page</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="groupHeaderBackgroundColor">Group Title Background Color</label>
                <div class="color-picker-container">
                    <input type="color"
                           class="form-color-input"
                           id="groupHeaderBackgroundColor"
                           name="groupHeaderBackgroundColor"
                           value="#fafafa"
                           aria-label="Choose group header background color">
                    <input type="text"
                           class="form-input color-hex-input"
                           id="groupHeaderBackgroundColorHex"
                           name="groupHeaderBackgroundColorHex"
                           value="#fafafa"
                           pattern="^#[0-9A-Fa-f]{6}$"
                           maxlength="7"
                           placeholder="#fafafa">
                </div>
                <div class="form-help">Background color for group headers (popup & start page)</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="urlItemBackgroundColor">URL Item Background Color</label>
                <div class="color-picker-container">
                    <input type="color"
                           class="form-color-input"
                           id="urlItemBackgroundColor"
                           name="urlItemBackgroundColor"
                           value="#ffffff"
                           aria-label="Choose URL item background color">
                    <input type="text"
                           class="form-input color-hex-input"
                           id="urlItemBackgroundColorHex"
                           name="urlItemBackgroundColorHex"
                           value="#ffffff"
                           pattern="^#[0-9A-Fa-f]{6}$"
                           maxlength="7"
                           placeholder="#ffffff">
                </div>
                <div class="form-help">Background color for URL items</div>
            </div>
        </form>
    </template>

    <!-- Color Settings Modal Footer Template (hidden) -->
    <template id="colorSettingsModalFooterTemplate">
        <button type="button" class="btn btn-secondary" id="resetColorTheme">Reset to Defaults</button>
        <button type="button" class="btn btn-secondary" id="cancelColorSettings">Cancel</button>
        <button type="submit" class="btn btn-primary" form="colorSettingsForm" id="saveColorSettings">Save Colors</button>
    </template>

    <!-- Loading Spinner (placeholder for future implementation) -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;" aria-hidden="true">
        <div class="loading-spinner" aria-label="Loading"></div>
        <p class="loading-text">Loading...</p>
    </div>

    <!-- Load shared utilities and models -->
    <script src="../utils/shared.js"></script>
    <script src="../utils/storageManager.js"></script>
    <script src="../utils/dataValidator.js"></script>
    <script src="../models/URLDataModel.js"></script>
    <script src="../models/GroupDataModel.js"></script>
    <script src="popup.js"></script>
</body>
</html>