# ðŸ› Bug: Group deletion causes data loss - All bookmarks in the group are deleted

## Summary
When a user deletes a group, all bookmarks within that group are permanently deleted instead of being moved to the "Ungrouped" default group. This causes unintended data loss.

## Severity
ðŸ”´ **Critical** - Data loss issue

## Steps to Reproduce
1. Create a new group (e.g., "Work")
2. Add several bookmarks to the group
3. Click the delete button on the group
4. Confirm the deletion dialog
5. **Expected**: Bookmarks should be moved to "Ungrouped" group
6. **Actual**: All bookmarks in the group are permanently deleted

## Current Behavior
- File: `popup/popup.js`, lines 948-999
- When `deleteGroup()` is called, it removes all URLs with `this.urls = this.urls.filter(u => u.groupId !== groupId)` (line 979)
- The confirmation message warns users: "This will also delete X bookmarks"
- All bookmarks are lost permanently

## Expected Behavior
- Bookmarks should be moved to the "Ungrouped" default group before the group is deleted
- The `moveURLsToDefaultGroup()` function already exists (lines 1003-1016) but is never called
- Users should not lose their bookmarks when organizing groups

## Technical Details

### Affected Code
```javascript
// popup/popup.js:948-999
async deleteGroup(groupId) {
    try {
        const group = this.groups.find(g => g.id === groupId);
        if (!group) {
            this.showError('Group not found');
            return;
        }

        if (!this.canDeleteGroup(groupId)) {
            this.showError('Cannot delete this group. It is protected.');
            return;
        }

        const urlsInGroup = this.urls.filter(u => u.groupId === groupId);
        const urlCount = urlsInGroup.length;

        const confirmMessage = urlCount > 0
            ? `Are you sure you want to delete the group "${group.name}"? This will also delete ${urlCount} bookmark${urlCount !== 1 ? 's' : ''} in this group.`
            : `Are you sure you want to delete the group "${group.name}"?`;

        if (!confirm(confirmMessage)) {
            return;
        }

        this.showLoading('Deleting group...');

        // âŒ BUG: This deletes all URLs in the group
        this.urls = this.urls.filter(u => u.groupId !== groupId);

        // Remove the group
        this.groups = this.groups.filter(g => g.id !== groupId);

        await this.saveData();
        this.renderURLs();

        this.showMessage(`Group "${group.name}" and ${urlCount} bookmark${urlCount !== 1 ? 's' : ''} deleted successfully!`);

        this.hideLoading();

    } catch (error) {
        console.error('Error deleting group:', error);
        this.showError(error.message || 'Failed to delete group');
        this.hideLoading();
    }
}
```

### Existing Helper Function (Not Being Used)
```javascript
// popup/popup.js:1003-1016
moveURLsToDefaultGroup(fromGroupId) {
    const defaultGroupId = this.getDefaultGroupId();
    let movedCount = 0;

    this.urls.forEach(url => {
        if (url.groupId === fromGroupId) {
            url.groupId = defaultGroupId;
            movedCount++;
        }
    });

    console.log(`Moved ${movedCount} URLs from group ${fromGroupId} to default group`);
    return movedCount;
}
```

## Proposed Fix

Replace line 979 with a call to `moveURLsToDefaultGroup()`:

```javascript
async deleteGroup(groupId) {
    try {
        const group = this.groups.find(g => g.id === groupId);
        if (!group) {
            this.showError('Group not found');
            return;
        }

        if (!this.canDeleteGroup(groupId)) {
            this.showError('Cannot delete this group. It is protected.');
            return;
        }

        const urlsInGroup = this.urls.filter(u => u.groupId === groupId);
        const urlCount = urlsInGroup.length;

        // âœ… FIX: Update confirmation message
        const confirmMessage = urlCount > 0
            ? `Are you sure you want to delete the group "${group.name}"? ${urlCount} bookmark${urlCount !== 1 ? 's' : ''} will be moved to "Ungrouped".`
            : `Are you sure you want to delete the group "${group.name}"?`;

        if (!confirm(confirmMessage)) {
            return;
        }

        this.showLoading('Deleting group...');

        // âœ… FIX: Move URLs to default group instead of deleting them
        this.moveURLsToDefaultGroup(groupId);

        // Remove the group
        this.groups = this.groups.filter(g => g.id !== groupId);

        await this.saveData();
        this.renderURLs();

        // âœ… FIX: Update success message
        this.showMessage(`Group "${group.name}" deleted. ${urlCount} bookmark${urlCount !== 1 ? 's' : ''} moved to Ungrouped.`);

        this.hideLoading();

    } catch (error) {
        console.error('Error deleting group:', error);
        this.showError(error.message || 'Failed to delete group');
        this.hideLoading();
    }
}
```

## Impact
- **User Experience**: Users may accidentally lose all their bookmarks when trying to reorganize groups
- **Data Loss**: Permanent deletion of user data without proper warning
- **Trust**: Users may lose trust in the extension if they lose important bookmarks

## Additional Context
- This issue was discovered during a comprehensive bug investigation
- Full bug report available in `BUG_REPORT.md`
- The helper function `moveURLsToDefaultGroup()` is already implemented but unused
- This follows common UX patterns where items are moved to a default location rather than deleted

## Labels
`bug`, `critical`, `data-loss`, `user-experience`

## Related Files
- `popup/popup.js` (lines 948-999, 1003-1016)

---

**Priority**: High - Should be fixed before next release to prevent data loss
